<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>âœ¨ ì±„ì›€ ìŠ¤ëŒ“ê³µ ê³ ê° ê´€ë¦¬ ì‹œìŠ¤í…œ âœ¨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@300;400;500;600&family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">
    <style>
        /* --- ê¸°ë³¸ & í…Œë§ˆ ì„¤ì • --- */
        :root {
            --bg-color: #f4f7f9;
            --card-bg-color: #ffffff;
            --text-color: #333;
            --primary-color: #4a90e2;
            --primary-hover: #357ABD;
            --secondary-color: #50e3c2;
            --secondary-hover: #38a892;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --success-color: #2ecc71;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.05);
            --font-main: 'IBM Plex Sans KR', sans-serif;
            --font-code: 'Nanum Gothic Coding', monospace;
        }

        [data-theme="dark"] {
            --bg-color: #2c3e50;
            --card-bg-color: #34495e;
            --text-color: #ecf0f1;
            --border-color: #4a627a;
            --shadow-color: rgba(0, 0, 0, 0.2);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            line-height: 1.6;
            padding: 20px;
        }
        
        /* --- ë ˆì´ì•„ì›ƒ ë° ì»¨í…Œì´ë„ˆ --- */
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 20px;
            color: var(--primary-color);
            font-weight: 600;
        }

        .card {
            background: var(--card-bg-color);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px var(--shadow-color);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .card h3, .card h4 {
            font-weight: 500;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* --- ì…ë ¥ ìš”ì†Œ ë° ë²„íŠ¼ --- */
        input[type="text"], input[type="password"], input[type="date"], button {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            font-size: 1em;
            transition: all 0.2s ease-in-out;
        }

        input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }

        button {
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        button.primary { background-color: var(--primary-color); }
        button.primary:hover { background-color: var(--primary-hover); transform: translateY(-2px); }

        button.secondary { background-color: var(--secondary-color); }
        button.secondary:hover { background-color: var(--secondary-hover); transform: translateY(-2px); }

        .row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        /* --- ê²°ê³¼ ë° ìƒíƒœ í‘œì‹œ --- */
        .result, .alert-result {
            margin-top: 20px;
            padding: 20px;
            background: var(--bg-color);
            border-radius: 8px;
            border-left: 5px solid var(--primary-color);
            font-size: 1.1em;
        }
        
        .red { color: var(--danger-color); }
        .blue { color: var(--primary-color); }
        .green { color: var(--success-color); }

        /* --- ê´€ë¦¬ì íŒ¨ë„ --- */
        #adminPanel { display: none; }
        
        .alert-section {
            background-color: rgba(243, 156, 18, 0.1);
            border: 1px solid var(--warning-color);
            border-radius: 8px;
            padding: 20px;
        }

        .alert-section h4 { color: var(--warning-color); }

        .alert-buttons { display: flex; gap: 15px; margin: 15px 0; }
        .alert-buttons button { background-color: var(--danger-color); }

        .urgent, .warning {
            padding: 12px 15px;
            border-radius: 6px;
            margin: 8px 0;
            color: white;
        }
        .urgent { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .warning { background: linear-gradient(45deg, #f39c12, #e67e22); }
        
        .message-box {
            background-color: var(--bg-color);
            border: 1px dashed var(--border-color);
            padding: 15px;
            margin-top: 10px;
            border-radius: 8px;
            font-family: var(--font-code);
            white-space: pre-wrap;
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: auto;
            padding: 5px 10px;
            font-size: 0.8em;
            background-color: var(--success-color);
        }

        /* --- í…Œì´ë¸” --- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        th {
            background-color: var(--card-bg-color);
            font-weight: 600;
            color: var(--primary-color);
        }
        tr:hover {
            background-color: var(--bg-color);
        }

        .table-actions button {
            width: auto;
            padding: 6px 12px;
            margin: 2px;
            font-size: 0.8em;
        }
        .edit-btn { background-color: #3498db; }
        .delete-btn { background-color: #e74c3c; }

        /* --- í…Œë§ˆ í† ê¸€ ë²„íŠ¼ --- */
        .theme-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 10px var(--shadow-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            transition: all 0.3s ease;
        }
        .theme-switcher:hover {
            transform: translateY(-3px) scale(1.1);
        }
    </style>
</head>
<body>
    <div class="theme-switcher" onclick="toggleTheme()" id="theme-toggle-btn">ğŸŒ™</div>
    <div class="container">
        <h1>ğŸ“ ì±„ì›€ ìŠ¤ëŒ“ê³µ ê³ ê° ê´€ë¦¬</h1>

        <div class="card">
            <h3>ğŸ‘¤ ê³ ê° ì „ìš© ì¡°íšŒ</h3>
            <input type="text" id="userSearch" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
            <button onclick="searchUser()" class="primary">ğŸ” ì¡°íšŒí•˜ê¸°</button>
            <div id="searchResult" class="result" style="display: none;"></div>
        </div>

        <div class="card">
            <h3>ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
            <input type="password" id="adminPass" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
            <button onclick="loginAdmin()" class="secondary">ğŸš€ ë¡œê·¸ì¸</button>
        </div>

        <div id="adminPanel" class="card">
            <h3>ğŸ“‹ ê´€ë¦¬ì ì „ìš© íŒ¨ë„</h3>
            
            <div class="alert-section">
                <h4>ğŸš¨ ì¢…ë£Œ ì„ë°• ì•Œë¦¼</h4>
                <div class="alert-buttons">
                    <button onclick="checkExpiringUsers()">ğŸ“… ì˜¤ëŠ˜ í˜„í™©</button>
                    <button onclick="generateKakaoMessages()">ğŸ’¬ ì¹´í†¡ ë©”ì‹œì§€ ìƒì„±</button>
                </div>
                <div id="alertResult" class="alert-result" style="display: none;"></div>
            </div>

            <h4 style="margin-top: 30px;">â• íšŒì› ì¶”ê°€ / ìˆ˜ì •</h4>
            <div class="row">
                <input type="text" id="newId" placeholder="ì•„ì´ë””">
                <input type="date" id="startDate">
                <input type="date" id="endDate">
            </div>
            <button onclick="addUser()" class="primary">ğŸ’¾ ì €ì¥í•˜ê¸°</button>

            <h4 style="margin-top: 30px;">ğŸ“Š ì „ì²´ íšŒì› ëª©ë¡ (<span id="memberCount">0</span>ëª…)</h4>
            <table id="userTable">
                <thead>
                    <tr>
                        <th>ì•„ì´ë””</th>
                        <th>ì‹œì‘ì¼</th>
                        <th>ì¢…ë£Œì¼</th>
                        <th>ìƒíƒœ</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            
            <h4 style="margin-top: 30px;">ğŸ”„ ë°ì´í„° ê´€ë¦¬</h4>
            <div class="row">
                <button onclick="backupData()">ğŸ“¤ ë°ì´í„° ë°±ì—… (JSON)</button>
                <button onclick="document.getElementById('fileInput').click()">ğŸ“¥ ë°ì´í„° ë³µì›</button>
                <button onclick="resetToDefault()" style="background-color: var(--danger-color);">ğŸ”„ ì´ˆê¸°í™”</button>
                <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="restoreData(this)">
            </div>
        </div>
    </div>

<script>
const ADMIN_PASSWORD = "7702";

const defaultUsers = {
    "epic_study": {
        "start": "2025-06-30",
        "end": "2025-07-30"
    },
    "hellenjj": {
        "start": "2025-07-07",
        "end": "2025-08-07"
    },
    "hge319": {
        "start": "2025-07-09",
        "end": "2025-08-09"
    },
    "mark1536": {
        "start": "2025-07-01",
        "end": "2025-08-01"
    },
    "meena1225": {
        "start": "2025-07-01",
        "end": "2025-08-01"
    },
    "meena77": {
        "start": "2025-07-01",
        "end": "2025-08-01"
    },
    "na_english": {
        "start": "2025-06-30",
        "end": "2025-07-30"
    },
    "somsatag1225": {
        "start": "2025-07-01",
        "end": "2025-08-01"
    },
    "thebrightedu": {
        "start": "2025-07-09",
        "end": "2025-08-09"
    },
    "ussua": {
        "start": "2025-07-24",
        "end": "2025-08-24"
    },
    "whiteyun8058": {
        "start": "2025-07-07",
        "end": "2025-08-07"
    },
    "whiteyun901": {
        "start": "2025-07-07",
        "end": "2025-08-07"
    },
    "ymmath00": {
        "start": "2025-07-28",
        "end": "2025-08-28"
    },
    "uyeong17": {
        "start": "2025-07-25",
        "end": "2025-08-25"
    },
    "yglajiasr632": {
        "start": "2025-07-25",
        "end": "2025-08-25"
    },
    "eg6404": {
        "start": "2025-07-02",
        "end": "2025-08-02"
    },
    "yoong_aa33": {
        "start": "2025-08-02",
        "end": "2025-09-02"
    }
};

let users = {};
let isLoggedIn = false;

// --- í…Œë§ˆ ê´€ë¦¬ ---
function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    document.getElementById('theme-toggle-btn').textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
}

function applyInitialTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
     document.getElementById('theme-toggle-btn').textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
}

// --- ì•± ì´ˆê¸°í™” ---
document.addEventListener('DOMContentLoaded', () => {
    applyInitialTheme();
    users = JSON.parse(JSON.stringify(defaultUsers));
});

// --- í•µì‹¬ ê¸°ëŠ¥ ---
function getDateStatus(endDate) {
    const today = new Date();
    const end = new Date(endDate);
    today.setHours(0, 0, 0, 0);
    end.setHours(0, 0, 0, 0);
    const diff = Math.ceil((end - today) / (1000 * 60 * 60 * 24));

    if (diff > 7) return { text: `âœ… ${diff}ì¼ ë‚¨ìŒ`, class: 'green' };
    if (diff >= 0) return { text: `âš ï¸ ${diff}ì¼ ë‚¨ìŒ`, class: 'red' };
    return { text: `âŒ ${Math.abs(diff)}ì¼ ì§€ë‚¨`, class: 'red' };
}

function searchUser() {
    const id = document.getElementById("userSearch").value.trim().toLowerCase();
    const box = document.getElementById("searchResult");
    box.style.display = 'block';

    if (!id) {
        box.innerHTML = '<span class="red">âŒ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
    }
    const user = users[id];
    if (!user) {
        box.innerHTML = `<span class="red">âŒ '${id}' ë‹˜ì€ ë“±ë¡ë˜ì§€ ì•Šì€ ì•„ì´ë””ì…ë‹ˆë‹¤.</span>`;
        return;
    }
    
    const status = getDateStatus(user.end);
    box.innerHTML = `
        <p><strong>ğŸ†” ì•„ì´ë””:</strong> <span class="blue">${id}</span></p>
        <p><strong>ğŸ—“ï¸ ì‹œì‘ì¼:</strong> ${user.start}</p>
        <p><strong>ğŸ“… ì¢…ë£Œì¼:</strong> ${user.end}</p>
        <p><strong>ğŸ“Š ìƒíƒœ:</strong> <span class="${status.class}">${status.text}</span></p>
    `;
}

function loginAdmin() {
    const pw = document.getElementById("adminPass").value.trim();
    if (pw === ADMIN_PASSWORD) {
        document.getElementById("adminPanel").style.display = "block";
        isLoggedIn = true;
        loadTable();
        alert("ğŸ‰ ê´€ë¦¬ì ëª¨ë“œë¡œ ë¡œê·¸ì¸í–ˆìŠµë‹ˆë‹¤.");
        document.getElementById("adminPass").value = "";
    } else {
        alert("âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
    }
}

function loadTable() {
    const body = document.querySelector("#userTable tbody");
    body.innerHTML = "";
    const keys = Object.keys(users).sort();
    document.getElementById("memberCount").textContent = keys.length;
    
    keys.forEach(id => {
        const status = getDateStatus(users[id].end);
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><strong>${id}</strong></td>
            <td>${users[id].start}</td>
            <td>${users[id].end}</td>
            <td><span class="${status.class}">${status.text}</span></td>
            <td class="table-actions">
                <button class="edit-btn" onclick="editUser('${id}')">âœï¸</button>
                <button class="delete-btn" onclick="deleteUser('${id}')">ğŸ—‘ï¸</button>
            </td>
        `;
        body.appendChild(row);
    });
}

function addUser() {
    const id = document.getElementById("newId").value.trim().toLowerCase();
    const start = document.getElementById("startDate").value;
    const end = document.getElementById("endDate").value;

    if (!id || !start || !end) {
        alert("âŒ ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.");
        return;
    }
    
    const isEdit = !!users[id];
    users[id] = { start, end };
    loadTable();
    
    document.getElementById("newId").value = "";
    document.getElementById("startDate").value = "";
    document.getElementById("endDate").value = "";
    alert(isEdit ? `âœ… ${id} ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.` : `âœ… ${id} ë‹˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

function editUser(id) {
    document.getElementById("newId").value = id;
    document.getElementById("startDate").value = users[id].start;
    document.getElementById("endDate").value = users[id].end;
    document.getElementById("newId").focus();
}

function deleteUser(id) {
    if (confirm(`â“ "${id}" ë‹˜ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        delete users[id];
        loadTable();
        alert(`âœ… ${id} ë‹˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }
}

function checkExpiringUsers() {
    const resultDiv = document.getElementById('alertResult');
    resultDiv.style.display = 'block';
    
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const expiring = Object.entries(users).map(([id, data]) => {
        const end = new Date(data.end);
        end.setHours(0,0,0,0);
        const diffDays = Math.ceil((end - today) / (1000 * 60 * 60 * 24));
        return { id, diffDays };
    }).filter(u => u.diffDays <= 7).sort((a, b) => a.diffDays - b.diffDays);

    if (expiring.length === 0) {
        resultDiv.innerHTML = '<div class="green">âœ… 7ì¼ ë‚´ì— ë§Œë£Œë˜ëŠ” íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }

    let html = '';
    expiring.forEach(({ id, diffDays }) => {
        if (diffDays < 0) {
            html += `<div class="urgent">@${id} (${Math.abs(diffDays)}ì¼ ì§€ë‚¨)</div>`;
        } else {
            html += `<div class="warning">@${id} (${diffDays}ì¼ ë‚¨ìŒ)</div>`;
        }
    });
    resultDiv.innerHTML = html;
}

function generateKakaoMessages() {
    const resultDiv = document.getElementById('alertResult');
    resultDiv.style.display = 'block';
    const today = new Date();
    today.setHours(0,0,0,0);

    const expiresToday = [], expiresTomorrow = [], expired = [];
    Object.keys(users).forEach(id => {
        const endDate = new Date(users[id].end);
        endDate.setHours(0,0,0,0);
        const diffDays = Math.ceil((endDate - today) / (1000*60*60*24));
        if (diffDays === 0) expiresToday.push(id);
        else if (diffDays === 1) expiresTomorrow.push(id);
        else if (diffDays < 0) expired.push(id);
    });

    const createMsgBox = (ids, title, message) => {
        if (ids.length === 0) return '';
        const text = `${ids.map(id => '@' + id).join(' ')}\n\n${message}`;
        return `
            <h5 style="margin-top:15px;">${title} (${ids.length}ëª…)</h5>
            <div class="message-box">
                ${text}
                <button class="copy-btn" onclick="copyText(\`${text.replace(/`/g, '\\`')}\`)">ğŸ“‹ ë³µì‚¬</button>
            </div>`;
    };

    let html = createMsgBox(expiresToday, 'ğŸ”´ ì˜¤ëŠ˜ ì¢…ë£Œ', `ì˜¤ëŠ˜(${today.toLocaleDateString('ko-KR')}) ì´ìš©ê¸°ê°„ì´ ì¢…ë£Œë©ë‹ˆë‹¤. ê²°ì œ í›„ ë©˜ì…˜ ì£¼ì„¸ìš”! ğŸ’³`);
    html += createMsgBox(expiresTomorrow, 'âš ï¸ ë‚´ì¼ ì¢…ë£Œ', `ë‚´ì¼ ì´ìš©ê¸°ê°„ì´ ì¢…ë£Œë©ë‹ˆë‹¤. ë¯¸ë¦¬ ê²°ì œí•´ì£¼ì„¸ìš”! ğŸ’³`);
    html += createMsgBox(expired, 'âŒ ì´ë¯¸ ì¢…ë£Œ', `ì´ìš©ê¸°ê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ì œ í›„ ë©˜ì…˜ ì£¼ì„¸ìš”! ğŸ’³`);
    
    resultDiv.innerHTML = html || '<div class="green">âœ… ì˜¤ëŠ˜ ë³´ë‚¼ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
}

function copyText(text) {
    navigator.clipboard.writeText(text).then(() => {
        alert('ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }).catch(err => {
        alert('âŒ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    });
}

// --- ë°ì´í„° ê´€ë¦¬ ---
function backupData() {
    const backupObj = {
        users: users,
        timestamp: new Date().toISOString(),
        version: "3.0",
        totalUsers: Object.keys(users).length
    };
    const dataStr = JSON.stringify(backupObj, null, 2);
    const blob = new Blob([dataStr], { type: "application/json;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `ì±„ì›€ìŠ¤ëŒ“ê³µ_ë°±ì—…_${new Date().toISOString().slice(0,10)}.json`;
    a.click();
    URL.revokeObjectURL(url);
    alert('ğŸ’¾ ë°ì´í„° ë°±ì—… íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
}

function restoreData(input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
        try {
            const data = JSON.parse(e.target.result);
            if (data && data.users) {
                users = data.users;
                loadTable();
                alert(`âœ… ë°ì´í„°ê°€ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤! (íšŒì› ${Object.keys(users).length}ëª…)`);
            } else {
                throw new Error("ìœ íš¨í•œ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.");
            }
        } catch (error) {
            alert('âŒ ë³µì› ì‹¤íŒ¨: ' + error.message);
        }
    };
    reader.readAsText(file);
    input.value = ''; // ë™ì¼í•œ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ ì´ˆê¸°í™”
}

function resetToDefault() {
    if (confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°ê°’ìœ¼ë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        users = JSON.parse(JSON.stringify(defaultUsers));
        loadTable();
        alert('ğŸ”„ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
}
</script>
</body>
</html>
